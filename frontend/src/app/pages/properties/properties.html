<div class="properties-container">
  <h1>Logements – Dubai Conciergerie</h1>

  <div *ngIf="errorMessage" class="error">
    {{ errorMessage }}
  </div>
  <div *ngIf="successMessage" class="success">
    {{ successMessage }}
  </div>

  <!-- Formulaire de création -->
  <div class="card">
    <h2>Nouveau logement pour le propriétaire #{{ ownerId }}</h2>

    <form (ngSubmit)="saveProperty()">
      <div class="form-row">
        <div class="form-group">
          <label>Titre (title)</label>
          <input
            type="text"
            [(ngModel)]="current.title"
            name="title"
            required
          />
        </div>

        <div class="form-group">
          <label>Ville (city)</label>
          <input
            type="text"
            [(ngModel)]="current.city"
            name="city"
            required
          />
        </div>
      </div>

      <div class="form-group">
        <label>Adresse (address)</label>
        <input
          type="text"
          [(ngModel)]="current.address"
          name="address"
          required
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Capacité (capacity)</label>
          <input
            type="number"
            [(ngModel)]="current.capacity"
            name="capacity"
            min="1"
            required
          />
        </div>

        <div class="form-group">
          <label>Type de location (rentalType)</label>
          <select
            [(ngModel)]="current.rentalType"
            name="rentalType"
            required
          >
            <option value="SHORT_TERM">SHORT_TERM</option>
            <option value="LONG_TERM">LONG_TERM</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Prix / nuit (nightlyPrice)</label>
          <input
            type="number"
            [(ngModel)]="current.nightlyPrice"
            name="nightlyPrice"
            min="0"
            step="0.01"
          />
        </div>

        <div class="form-group">
          <label>Prix / mois (monthlyPrice)</label>
          <input
            type="number"
            [(ngModel)]="current.monthlyPrice"
            name="monthlyPrice"
            min="0"
            step="0.01"
          />
        </div>
      </div>

      <div class="form-actions">
        <button type="submit">Créer</button>
        <button type="button" class="btn-secondary" (click)="resetForm()">
          Réinitialiser
        </button>
      </div>
    </form>
  </div>

  <!-- Liste -->
  <div class="card">
    <h2>Liste des logements du propriétaire #{{ ownerId }}</h2>

    <div class="filters">
      <div class="form-inline">
        <label>Filtrer (titre ou ville)</label>
        <input
          type="text"
          [(ngModel)]="filterCityOrTitle"
          name="filterCityOrTitle"
          placeholder="Dubai Marina, JVC, Studio..."
        />
      </div>
    </div>

    <div *ngIf="loading">Chargement…</div>

    <table *ngIf="!loading && filteredProperties.length > 0">
      <thead>
        <tr>
          <th>#</th>
          <th>Titre</th>
          <th>Ville</th>
          <th>Adresse</th>
          <th>Capacité</th>
          <th>Type</th>
          <th>Prix / nuit</th>
          <th>Prix / mois</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of filteredProperties">
          <td>{{ p.id }}</td>
          <td>{{ p.title }}</td>
          <td>{{ p.city }}</td>
          <td>{{ p.address }}</td>
          <td>{{ p.capacity }}</td>
          <td>
            <span class="badge"
              [ngClass]="{
                'badge-short': p.rentalType === 'SHORT_TERM',
                'badge-long':  p.rentalType === 'LONG_TERM'
              }">
              {{ p.rentalType }}
            </span>
          </td>
          <td>
            <ng-container *ngIf="p.nightlyPrice != null; else noNight">
              {{ p.nightlyPrice | number: '1.0-2' }} €
            </ng-container>
            <ng-template #noNight>-</ng-template>
          </td>
          <td>
            <ng-container *ngIf="p.monthlyPrice != null; else noMonth">
              {{ p.monthlyPrice | number: '1.0-2' }} €
            </ng-container>
            <ng-template #noMonth>-</ng-template>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!loading && filteredProperties.length === 0">
      Aucun logement ne correspond à ces critères.
    </div>
  </div>
</div>
